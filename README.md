### Функциональные требования, пользователь может:
1.	Просматирвать каталог
2.	Добавить товар в заказ или несколько товаров
3.	Изменять список товаров в заказе
4.	Выбирать время доставки в заказе
5.	Произвести оплату после выбора параметров доставки
6.	Просматривать уведомление, о незавершенном заказе

### Нефункциональные требования:
1.	Надежность — сайт должен быть доступен для пользователей из России определенный процент времени в месяц.
2.	Производительность — загрузка страниц должна быть осуществлена за опредленное минимальное время.
3.	Масштабируемость — система должна поддерживать минимальное кол-во пользователей.
4.	Безопасность - доступ к базе данных только у администратора.
5.	Взаимодействие между модулями происходит через API.
6.	Обращение к внешней системе происходит по протоколу HTTP.
7.	Магазин выбирает оптимальный аккаунт, чтобы доставить заказ в выбранное время.
8.	Сохранение историй обращений к внешней системе, включающее результаты обращения, длительность и уникальный id операции, который генерирует внешняя система при обращении.
9.	 Существование метрики длительность процесса финализации.
10.	 Существование метрики qps к внешней системе: оповещения о “брошенной” корзине, количество успешных/неуспешных сабмитов, 
11.  Неуспешные запросы должны быть сгруппированы по кодам ответа
12.	 Существование метрики: среднее время, которое проходит от бронирования до оплаты заказа.

### Сбор заказа(корзины):

- User (Пользователь) - это человек использующий наш интернет-магазин
- Product (Товар) - это физический продукт, предназначенные для продажи пользователям для удовлетворения их потребностей
- Catalog (Каталог) - все товары в магазине
- Basket(корзина) - некая сущность, которая хранит в себе Basket position
- Basket position (Позиция корзины) - товар и его количество
- Creating basket (Создание корзины) - выбор товара и его количества с добавлением в заказ
- Order (заказ) - это такой объект, который содержит в себе Basket, User, Delivery time
- Making order (Оформление заказа) - этап формирования заказа, на котором пользователь подтверждает намерение оплатить его и бронирует время доставки 
- Delivery time (Время доставки) - период(слоты) времени за который пользователь должен получить заказ
Abandoned basket ("брошенные" корзины) - созданные заказы, которые пользователь не забронировал
- DISCARDED order (Отмененный заказ) - это такой заказ, который за некий промежуток времени не был подтвержден пользователем, к которому пользователь больше не имеет доступа

![Диаграмма последовательности Сбор корзины](./image/Рисунок1.png)

### Доставка:

![Диаграмма последовательности Сбор корзины](./image/Рисунок2.png)

- customer (покупатель) - человек который использует наш сервис.
- deliveryService (Служба доставки) - система отвечающая за доставку товаров.
- order (заказ) - это совокупность товаров, которая содержит сведения о них и состоянии заказа в целом. (Синоним к Order из словаря сбора заказов)
- payment (Процесс оплаты) - процесс, вовремя которого покупатель совершает оплату заказа.
- timeDilevery (время доставки) - время, необходимое courierService необходимое для доставки заказа покупателю начиная с момента формирования заказа, и заканчивая его оплатой и доставкой.
- refundOrder (возврат стоимости заказа) - возврат стоимости заказа, если доставка не была выполнена вовремя и либо невозможное время доставки.
- failedDelivery(Доставка невовремя) - доставка, которая по каким-то причинам выполнилась не в срок.
- slotsDelivery (Доступное время доставки) - магазин предоставляет возможные временные слоты доставки, благодаря которым пользователь должен выбрать желаемое время получения заказа.
- queueOnDelivery (очередь на доставку) - после оплаты, заказ встает в так называемую очередь на доставку.
- orderProcessingTime (время обработки заказа) - это время с момента размещения заказа до его отправки.
- MTOProcessing( MaxTimeOrder processing верхний порог времени для обработки одного заказа) - верхний порог времени для обработки одного заказа.
- optimalAccount (Оптимальный аккаунт) - аккаунт, который выбирает магазин чтобы доставить заказ в выбранное время и за минимальное количество времени.
- impossibleTime (Невозможное время доставки) - невозможное время доставки из-за чего производится рефанд стоимости.
PAID → SHIPPING
●	Когда сабмит доставки во внешнюю систему произошел успешно (курьерская служба приняла заказ)
PAID → REFUND
●	Если заказ не был отправлен службе доставки (большая очередь, нет смысла ждать или служба доставки недоступна после проведения {какого-то количества} повторных попыток)
SHIPPING → REFUND
●	Если время доставки было больше заявленного или если доставка была неудачной.
SHIPPING → COMPLETED
![Диаграмма последовательности Сбор корзины](./image/Рисунок3.png)

### Оплата:

![Диаграмма последовательности Сбор корзины](./image/Рисунок4.png)

- user(синонимы: customer) (пользователь) - человек который использует наш сервис.
- externalSys (внешняя система) - внешняя система оплаты заказа.
- Reserv (бронирование товара) - система бронирует товар, когда пользователь оформляет заказ
- makingOrder (оформление заказа) - действие пользователя по завершению сбора корзины
- SLA (время от сабмита во внешнюю систему до появления информации об успешности или неуспешности оплаты)
- successfulPay (удачная оплата) - удачная оплата происходит в случае если пользователь удовлетворяет условиям системы (не было ошибки системы, достаточно денег, не прошло время после оформления заказа)
- notSuccessfulPay (не удачная оплата) - неудачная оплата происходит в случае если пользователь не удовлетворяет условиям системы (ошибка системы, недостаточно денег, прошло много времени после оформления заказа)
- externalSysAcc (аккаунт внешней системы) - конкретный аккаунт внешней системы оплаты
- TimeAfterOrder(Время после оформления заказа) - время которое дается пользователю для оплаты заказа после оформления
- reOrder(Повторное оформление заказа) - действие которое делает пользователь если на этапе оформления/оплаты заказа у него/системы произошла ошибка.
- dataUser(информация о пользователе) - информация которую передает пользователь системе(платежные данные, данные пользователя).
- orderPrice(сумма заказа) - сумма заказа в корзине пользователя
- sysError(Ошибка система) - ошибка, которая может произойти в системе на любом этапе работы.
- changeExternalSysAcc (Смена внешней системы) - действие которое делает система, если с текущей внешней системой произошла ошибка. Система меняет внешнюю на другую.
- orderStatus (состояние заказа) - информация о том, какой статус имеет наш заказ
- Collecting - сбор
- Booked - забронирован
- Discard - отказаться
- Paid - оплаченный
- Shipping - перевозка
- Refund - возврат
- Completed – завершенный

![Диаграмма последовательности Сбор корзины](./image/Рисунок5.png)

![Диаграмма последовательности Сбор корзины](./image/Рисунок6.png)

1.	Пользователи
  1.1.	Api
  1.1.1.	Сервис(интерфейс для регистрации/удаления/поиска/получения данных пользователя)
  1.1.2.	Модель(Описание сущности пользователь, Описания запроса на регистрацию)
  1.1.3.	Контроллер(Реализация сервиса, Post запрос на регистрацию пользователя, Get запрос Получить текущую информацию о пользователе, Delete запрос Удалить текущего пользователя)
  1.1.4.	Ивенты(События созданные или удаленные пользователем)
1.2.	Имплементация
  1.2.1.	Сущность(описание сущности пользователя и вызов конструктора)
  1.2.2.	Репозиторий(Некий репозиторий пользователя, скорее всего наше взаимодействие с бд)
  1.2.3.	Util(Использование????)( Отлов ошибок модели значений пользователя )
  1.2.4.	Сервис(Логика и описание взаимодействия с Api сервисом, некое логирование и взаимодействие с репозиторием )
  1.2.5.	Логирование(Логировать сообщения о регистрации/ удаления пользователя, получить имя и некий шаблон)
2.	Оповещения
 2.1.	Api
  2.1.1.	Сервис(Функция о новом пользователе берет модель пользователя, Функция о назначенной задаче берет модель задачи)
  2.2.	Имплементация
  2.2.1.	Сервис(Служба уведомлений-заглушек, использует сервис оповещений, функции процесса логирования нового пользователя и назначенной задачи)
  2.2.2.	Репозиторий(Некий репозиторий оповещения пользователя, скорее всего наше взаимодействие с бд)
  2.2.3.	Сущность(описание сущности оповещения пользователя по email и вызов конструктора)
  2.2.4.	Ивенты(Прослушиватель событий модуля уведомлений, Подписка на одновременные сообщения о новом пользователе и назначенной задачи)
3.	Задачи
 3.1.	Api
  3.1.1.	Сервис(интерфейс для получения всех задач/ по id/ удалить задачу по id/ создать/ назначить задачу)
  3.1.2.	Модель(Описание сущности задачи, Описания статуса задачи в процессе сделана или сделать)
  3.1.3.	Контроллер(Реализация сервиса, Post запрос на создания задачи Назначить задачу определенному пользователю, Get запрос Получить все задачи или по id, Delete запрос Удалить задачу по id)
  3.1.4.	Ивенты(События создания/удаления/назначение задачи)
 3.2.	Имплементация
  3.2.1.	Сущность(описание сущности задачи, вызов конструктора и функция приведения сущности к строке)
  3.2.2.	Репозиторий(Некий репозиторий задач, скорее всего наше взаимодействие с бд, функция удалить все по автору)
  3.2.3.	Util(Использование????)( Реализация задачи с сущности и реализация модели задачи )
  3.2.4.	Сервис(Сервис задач, который имеет некое логирование и взаимодействие с репозиторием задач, функции: получить все задачи, получить задачу по ID, добавить задачу, назначить задачу, удалить задачу по ID )
  3.2.5.	Логирование(Логировать сообщения о создании/ удаления/постановки задачи, получить имя и некий шаблон)
  3.2.6.	Ивенты(Прослушиватель событий модуля задачи, когда удаляется какой-то пользователь, то происходит удаление всех задач от этого пользователя и запись об этом в логи)
4.	Авторизация
 4.1.	Api
  4.1.1.	Контроллер(обрабатывает аутентификацию нового пользователя).
  4.1.2.	Модель(модель авторизации пользователя)
  4.1.3.	Сервис(Интерфейс сервиса с запросом на аутентификацию и результатом этого запроса)
 4.2.	Имплементация
  4.2.1.	Конфигурация(Свойства безопасности с указанием времени жизни токена)
  4.2.2.	Сервис(Сервис авторизации по умолчанию и класс отвечающий за генерацию и проверку токенов) 
5.	Общие данные
 5.1.	Конфигурация
  5.1.1.	Конфигурация шины событий(Создает пул потоков, который повторно использует фиксированное количество потоков, работающих в общей неограниченной очереди, используется для создания новых потоков при необходимости.Также создается асинхронное сообщение, унаследовавшее событие, чтобы быть точным, где мы можем указать обработку сообщения.)
  5.1.2.	Почтовый процессор событий( позволяет настраивать модификацию новых экземпляров бобов, созданных Spring Bean Factory)
  5.1.3.	Api (определяет подробности о схеме безопасности, которую использует API(протокол авторизации/Имя значения заголовка, представленного в запросе/scheme: Использующаяся с авторизацией типа http))
 5.2.	Перехватчики ошибок
  5.2.1.	 AccesDeniedException - Ошибка отказа в доступе(конструкторы по выдаче сообщения и причины)
  5.2.2.	NotFoundException - httpStatus не найден, конструктор сообщений и причины.
  5.3.	Логирование
  5.3.1.	Общие заметные события. Шина событий отправила сообщение. Получено сообщение. Ситуация предупреждения. Описание.Переопределение получения шаблона и получение имени.
 5.4.	Метрики
  5.4.1.	Сборщик метрик демо-сервиса
  5.5.	Контроль безопасности
  5.5.1.	JSON Web Tokens (JWT). 
  5.5.2.	аутентификация - проверка учетных данных пользователя.
  5.5.3.	Авторизация - проверка прав пользователя на доступ к определенным ресурсам. 
  5.5.4.	access token - используется для авторизации запросов и хранения дополнительной информации о пользователе.
  5.5.5.	refresh token - выдается сервером по результам успешной аутентификации и используется для получения новой пары access/refresh токенов. Каждый токен имеет свой срок жизни.

